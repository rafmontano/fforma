<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
box-sizing: border-box;
min-width: 200px;
max-width: 980px;
margin: 0 auto;
padding: 45px;
padding-top: 0px;
}
</style>


</head>

<body>

<h1 id="fforma-feature-based-forecast-model-averaging">FFORMA:
Feature-based Forecast Model Averaging</h1>
<h2 id="introduction--citation-info">Introduction &amp; Citation
Info</h2>
<p>The fforma package provides tools for forecasting using a model
combination approach. It can be used for model averaging or model
selection. It works by training a ‘classifier’ that learns to
select/combine different forecast models.</p>
<p>More information about metalearning for forecasting, read/cite the
paper:</p>
<ul>
<li><a href="https://robjhyndman.com/publications/fforma/">FFORMA:
Feature-based Forecast Model Averaging (To appear in International
Journal of Forecasting)</a></li>
</ul>
<p>This package came out of the FFORMA method presented to the M4
forecasting competition, but has been improved and no longer can be used
for reproducing results. For exact reproducibilty of results, check <a href="https://github.com/robjhyndman/M4metalearning">the M4metalearning
github repo</a>. For empirical performance, the fforma package, not
M4metalearning, should be used.</p>
<h2 id="installation">Installation</h2>
<p>Temporarily, as a workaround, a custom version of the
<code>xgboost</code> package is required. You may install it manually
from:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># install.packages(&quot;devtools&quot;)</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;pmontman/customxgboost&quot;</span>)</span></code></pre></div>
<p>Please note this if you use the latest version of the real xgboost
package, <em>it will be overwritten.</em> We will patch this
problem/workaround as soon as posssible.</p>
<p>Then the package can then be installed:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co">#install.packages(&quot;devtools&quot;)</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;rafmontano/fforma&quot;</span>)</span></code></pre></div>
<h2 id="usage">Usage</h2>
<p>The package can be used easily with two main functions:
<code>train_metalearning</code> and <code>forecast_metalearning</code>.
Both functions work on a <code>list</code> of elements with a particular
data structure: A time series and some meta-data. Basically, each
element in this list has <em>at least</em> the component <code>$x</code>
with a time series as a <code>ts</code> object, which is the series we
want to forecast.</p>
<h3 id="training-fforma">Training FFORMA</h3>
<p>The <code>train_metalearning</code> function will look for the
component <code>$h</code> in the elements of the input list, where
<code>$h</code> represents the desired prediction horizon. If not found,
it will consider <code>h</code> to one seasonal period of the series.
Then it substracts <code>h</code> observations from the time series
<code>$x</code> and sets them as true future values in the component
<code>$xx</code>. This process is named temporal holdout. If the series
in the training set have the <code>$xx</code> component, FFORMA will use
it instead of removing the last <code>h</code> observations of each
series.</p>
<p>Then the metalearning model is trained (takes a bit of time, see
Paralellism section below). The output of the
<code>train_metalearning</code> are the components: the metalearning
model, the training dataset (after the temporal holdout) and the
information about the training process. This output of the training
process can be used to forecast with the
<code>forecast_metalearning</code> function.</p>
<p>In the example, we will use a dataset of time series from the Mcomp
package as training set, which already follows the required format (a
list with elements having the <code>$x</code>. Additionally the
<code>$h</code> is provided).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">library</span>(fforma)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#The dataset of time series we want to forecast</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>ts_dataset <span class="ot">&lt;-</span> Mcomp<span class="sc">::</span>M3[<span class="fu">sample</span>(<span class="fu">length</span>(Mcomp<span class="sc">::</span>M3), <span class="dv">30</span>)]</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#train!</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>fforma_fit <span class="ot">&lt;-</span> <span class="fu">train_metalearning</span>(ts_dataset)</span></code></pre></div>
<h3 id="forecasting-with-fforma">Forecasting with FFORMA</h3>
<p>The <code>forecast_ metalearning</code> takes a metaleaning model
(the output of <code>train_metalearning</code> or equivalent) and a
dataset of time series we want to forecast. This dataset is a list in
the same format, though now the <code>$h</code> component if necessary,
not optional. The dataset for forecasting can be the same as the one
used for training (since it uses crossvalidation by temporal holdout for
training).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>fforma_forec <span class="ot">&lt;-</span> <span class="fu">forecast_metalearning</span>(fforma_fit, ts_dataset)</span></code></pre></div>
<p>Thats’ it, two lines of code! If the dataset we forecast has the
<code>$xx</code> component in its elements, fforma will use it as the
‘true’ future values of each series <code>$x</code> and calculate the
OWA, MASE and SMAPE forecast errors.</p>
<p><code>forecast_metalearning</code> outputs a dataset of time series
similar to its input, but with the added forecasts in the component
<code>$ff_meta_avg</code> of each element of the list.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co">#get the forecasts of the first series</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>fforma_forec<span class="sc">$</span>dataset[[<span class="dv">1</span>]]<span class="sc">$</span>ff_meta_avg</span></code></pre></div>
<h3 id="advanced-customizing-the-base-forecast-models">Advanced:
Customizing the base forecast models</h3>
<p>FFORMA learns to combine individual forecast models. By default it
uses a set of forecasting models implemented in the forecast R package,
such as <code>auto.arima</code>, <code>ets</code>, <code>thetaf</code>,
etc. The set of methods that FFORMA learns to combine is passed in the
<code>forec_methods</code> argument to the
<code>train_metalearning</code> function. This argument should be a list
of strings. Each string is the list shoudl coincide with the name of an
existing forecasting function. This forecasting function is a simple
function with two arguments: a ts object and the number of forecast
horizons. When forecasting, FFORMA assumes that the custom functions
used for training are available in the environment. To illustrate this
process, we will fully customize fforma to learn to combine two forecast
models of our own design, one forecasting the mean of the series and the
other outputting zeroes.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co">#a function that takes x, a ts() and h an integer with the desired forecast horizon</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>my_mean_forec <span class="ot">&lt;-</span> <span class="cf">function</span>(x, h) { </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="fu">mean</span>(x), h)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>}</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>my_zero_forec <span class="ot">&lt;-</span> <span class="cf">function</span>(x,h) {</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="dv">0</span>, h)</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>}</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#a list of strings, each the name of the forecasting function</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>list_of_methods <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;my_mean_forec&quot;</span>, <span class="st">&quot;my_zero_forec&quot;</span>)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#call fforma with the customized forecast functions</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>custom_fforma_fit <span class="ot">&lt;-</span> <span class="fu">train_metalearning</span>(ts_dataset, <span class="at">forec_methods=</span>list_of_methods)</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#the actual forecasting from the customized fforma</span></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a>custom_fforma_forec <span class="ot">&lt;-</span> <span class="fu">forecast_metalearning</span>(custom_fforma_fit, ts_dataset)</span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="co">#errors should be quite hight</span></span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>custom_fforma_forec<span class="sc">$</span>owa_errors</span></code></pre></div>
<h3 id="parallelism-and-saverestore-progress">Parallelism and
Save/Restore progress</h3>
<p>Forecasting with FFORMA can take a bit of time depending of the
individual models that are going to be combined for forecasting and the
size of the dataset. Parallelism through the <code>future</code> package
is provided and the processing can be periodically saved to disk and
resumed in the case of failure (like power outage, or an impending
Windows update).</p>
<p>The user just needs to select the <code>future::plan</code> and then
paralellism is handled transparently. More info about future
plans/capabilities <a href="https://github.com/HenrikBengtsson/future">here</a>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co">#the user enables, in this case, basic multicore parallelism through several processes</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(future<span class="sc">::</span>multiprocess)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#train with parallelism enabled, no changes to the code</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>fforma_fit <span class="ot">&lt;-</span> <span class="fu">train_metalearning</span>(ts_dataset)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#forecast with parallelism enabled, no changes to the code</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>fforma_forec <span class="ot">&lt;-</span> <span class="fu">forecast_metalearning</span>(fforma_fit, ts_dataset)</span></code></pre></div>
<p>For saving intermediate results, <code>train_metalearning</code> and
<code>forecast_metalearning</code> have the <code>save_foldername</code>
parameter, which must be set to the name of the folder to save the
intermediate results. If this parameter is set to <code>NULL</code>, no
saving/resume is used. If <code>save_foldername</code> is set to an
existing folder, the functions will try to resume the processing from
the state saved in the folder. So the basic use is to launch
<code>train_metalearning</code> or <code>test_metalearning</code> with a
specific <code>save_foldername</code>, and if the process is
interrupted, we launch them again with the same
<code>save_foldername</code> vale an process will resume.</p>
<p>An important additional parameter to use with
<code>chunk_size</code>, which indicates how many time series are
processed between savings. If we set <code>chunk_size=1000</code>, the
traing/forecast process will stop to save progress each 1000 series. Too
large value for <code>chunk_size</code> will run risk of losing a lot of
progress, too small will waste a lot of time saving to disk. An
automatic guess of <code>chunk_size</code> is provided if
<code>chunk_size=NULL</code>, but it is highly recommended that the
users set it manually to their needs.</p>
<p>Saving can be combined with parallelism.</p>
<p>An example of saving to disk</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co">#run with saving to disk (</span><span class="al">NOTE</span><span class="co"> chunk_size=10 is too low!, just for example)</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>fforma_fit <span class="ot">&lt;-</span> <span class="fu">train_metalearning</span>(ts_dataset, <span class="at">chunk_size =</span> <span class="dv">10</span>, <span class="at">save_foldername =</span> <span class="st">&quot;my_tmp_fforma&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#imagine that the powers goes of when series 14 is being processed...</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#...</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#... BOOM!</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#...</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co"># Now we want to resume!</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#We just call use the same function call, now it will try to resume</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#train_metalearning will start from series 11 if it finds</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#the temp files in save_foldername</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>fforma_fit <span class="ot">&lt;-</span> <span class="fu">train_metalearning</span>(ts_dataset, <span class="at">chunk_size =</span> <span class="dv">10</span>, <span class="at">save_foldername =</span> <span class="st">&quot;my_tmp_fforma&quot;</span>)</span></code></pre></div>
<h3 id="forecast-methods">Forecast methods</h3>
<p>The users can select which basic forecast methods are combined
through fforma. The default is based on the fforma submission to the M4
competition <a href="https://robjhyndman.com/publications/fforma/">(see
the reference)</a></p>
<h3 id="combination-by-model-averaging-or-model-selection">Combination
by Model Averaging or Model Selection</h3>
<p>The training can be fine-tuned towards either model selection or
model averaging by setting the <code>objective</code> parameter in
<code>train_metalearning</code> too either <code>&quot;averaging&quot;</code>
(default) or <code>&quot;selection&quot;</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>fforma_fit <span class="ot">&lt;-</span> <span class="fu">train_metalearning</span>(ts_dataset, <span class="at">objective =</span> <span class="st">&quot;selection&quot;</span>)</span></code></pre></div>
<h3 id="advanced-use">Advanced use</h3>
<p>The package provides functions for manually tuning the
training/forecasting processes. TO BE COMPLETED</p>

</body>
</html>
